# Запросы к бэкенду для доработок приложения

Ниже перечислены эндпоинты и контракты, которые нужны фронту. Остальное (чекбокс согласия, скролл рецептов, кнопка «+» в трекере, ссылка на сайт, убрать дубли старта) делается на фронте.

---

## 1. Регистрация: согласие на обработку персональных данных

- **Что есть на фронте:** чекбокс «Согласен с обработкой персональных данных» (ссылки на PDF на фронте).
- **Что нужно от бэка:** при регистрации фронт будет отправлять флаг согласия. Нужно договориться об имени поля и формате.

**Предложение:**

- В теле `POST /api/auth/register` добавить (или принять) поле:
  - `consentAccepted: boolean` или `agreementAccepted: boolean`
- Либо бэк не хранит, а только проверяет наличие поля (регистрация без `true` не принимается на фронте).

Уточнить с бэком: нужно ли сохранять факт/дату согласия в БД для юридов.

---

## 2. Восстановление пароля через почту

Нужны два эндпоинта.

### 2.1 Запрос на сброс (отправка письма)

- **Метод и путь:** `POST /api/auth/forgot-password` (или `/api/password/reset-request`).
- **Тело:** `{ "email": "user@example.com" }`.
- **Ответ при успехе:** например `200` с телом `{ "message": "Если email есть в системе, на него отправлена ссылка для сброса" }` (не раскрывать, есть ли email в системе, с точки зрения безопасности).
- **Поведение бэка:** отправить на указанный email ссылку с одноразовым токеном (или код) для сброса пароля. Ссылка ведёт на экран в приложении (deep link) или на веб-страницу, где пользователь вводит новый пароль.

### 2.2 Установка нового пароля

- **Метод и путь:** `POST /api/auth/reset-password` (или `/api/password/reset`).
- **Тело (вариант с токеном из ссылки):**
  ```json
  { "token": "строка_из_ссылки_письма", "newPassword": "новый_пароль" }
  ```
- **Либо вариант с кодом из письма:**
  ```json
  { "email": "user@example.com", "code": "код_из_письма", "newPassword": "новый_пароль" }
  ```
- **Ответ:** `200` при успехе, `400` при неверном/истёкшем токене или слабом пароле.

Нужно от бэка: точный контракт (имена полей, формат токена/кода, пример ссылки для deep link).

---

## 3. Замеры (измерения) в личном кабинете

Нужны: список замеров, добавление нового замера, при необходимости — последний замер для подстановки в форму.

### 3.1 Список замеров пользователя

- **Метод и путь:** `GET /api/measurements` (или `GET /api/user/measurements`).
- **Ответ:** например:
  ```json
  {
    "items": [
      {
        "id": 1,
        "date": "2025-01-15",
        "weight": 72.5,
        "chest": 95,
        "waist": 80,
        "hips": 100
      }
    ]
  }
  ```
- Список отсортировать по `date` по убыванию (последний первым). Опционально: пагинация.

Уточнить с бэком полный набор полей (рост, плечи, шея и т.д.), типы и единицы измерения.

### 3.2 Добавить замер

- **Метод и путь:** `POST /api/measurements` (или `POST /api/user/measurements`).
- **Тело:** те же поля, что в элементе списка (без `id`), например:
  ```json
  {
    "date": "2025-01-20",
    "weight": 72,
    "chest": 95,
    "waist": 79,
    "hips": 99
  }
  ```
- **Ответ:** `201` и созданный объект с `id` и полями.

### 3.3 (Опционально) Последний замер

- Либо фронт берёт первый элемент из `GET /api/measurements`.
- Либо бэк даёт отдельно: `GET /api/measurements/latest` с одним объектом для подстановки в форму.

---

## 4. Трекер: новые привычки без баллов

- Уже есть: `POST /api/trackers` для создания трекера/привычки.
- **Требование по ТЗ:** за добавленные привычки баллы не начисляются.
- Нужно от бэка: при создании новой привычки (новый трек) не начислять баллы. Либо в теле запроса передаётся флаг, например `earnPoints: false`, либо бэк сам считает «новые» привычки и не начисляет за них баллы. Уточнить контракт.

---

## 5. Что не требует изменений бэка

- Чекбокс согласия на форме регистрации (текст и ссылки на PDF) — только фронт; при необходимости передаём флаг в существующий `POST /api/auth/register`.
- Убрать дублирование старта работы — логика на фронте (флаги/локальное сохранение).
- Виджет статистики по замерам и кнопка «Добавить измерения» — фронт; данные через эндпоинты из п. 3.
- Кнопка «+» на вкладке «Трекер» — фронт; создание через существующий `POST /api/trackers`.
- Ссылка на http://stroynaya.online — только фронт (кнопка/ссылка).
- Скролл в разделе «Рецепты» (изображение смещается при скролле) — только фронт.

---

## Краткий чеклист для бэкенда

| Задача | Эндпоинт / изменение |
|--------|----------------------|
| Согласие при регистрации | Принять/сохранить флаг в `POST /api/auth/register` (имя поля уточнить) |
| Восстановление пароля | `POST /api/auth/forgot-password`, `POST /api/auth/reset-password` + контракт полей и письмо |
| Замеры: список | `GET /api/measurements` (или аналог) с полями дата, вес, объёмы |
| Замеры: добавить | `POST /api/measurements` с телом замера |
| Трекер: новые привычки без баллов | Уточнить правило в `POST /api/trackers` (флаг или логика на бэке) |

После согласования контрактов можно зафиксировать их в OpenAPI/Swagger или в этом файле.

---

## iOS и установка приложения (PWA vs нативное)

**Текущее приложение** — React Native (Expo), это **нативное** приложение (не веб).

### Вариант A: Публикация нативного приложения в App Store

- Нужен **Apple Developer Account** ($99/год).
- Сборка: `eas build --platform ios` (Expo) или Xcode.
- Загрузка в **App Store Connect**, модерация, публикация.
- Пользователи ставят приложение из App Store. Это единственный официальный способ раздавать нативное iOS-приложение обычным пользователям.

### Вариант B: PWA (сайт «установить на экран»)

- **PWA** — это веб-сайт с manifest и (опционально) service worker. Пользователь открывает сайт в Safari, нажимает «Добавить на экран „Домой“» — на главном экране появляется иконка, открывающая тот же сайт в браузере.
- Это **не** то же приложение, что твой React Native проект. Для PWA нужна отдельная **веб-версия** (например, тот же функционал на React, развёрнутый на https://stroynaya.online).
- Плюсы: не нужен Apple Developer, не нужна модерация. Минусы: ограничения веба (нет push в том же виде, что в нативном приложении, возможны ограничения в фоне и доступе к устройству).

### Вариант C: TestFlight (бета без стора)

- Для тестеров можно раздавать нативную сборку через **TestFlight** (до 10 тыс. тестеров). Всё равно нужен Apple Developer Account и сборка в Xcode / EAS.

**Итог:** «Оформить React Native как PWA и ставить на iOS через экран домой» нельзя: PWA — это всегда веб. Либо делаешь веб-версию (PWA) на stroynaya.online и даёшь «Добавить на главный экран», либо публикуешь нативное приложение в App Store (или раздаёшь через TestFlight).
